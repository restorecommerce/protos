syntax = "proto3";

package io.restorecommerce.access_control;

import "google/protobuf/any.proto";

/**
* Access control service interface.
*/

message Request {
  Target target = 1;
  // generic data structure which can be provided
  // to a contextQuery (see io/restorecommerce/rule.proto)
  Context context = 2;
}

message Context {
  google.protobuf.Any subject = 1;
  repeated google.protobuf.Any resources = 2;
  google.protobuf.Any security = 3;
}

message Response {
  enum Decision {
    PERMIT = 0;
    DENY = 1;
    NOT_APPLICABLE = 2;
    INDETERMINATE = 3;
  }
  Decision decision = 1;
  string obligation = 2;
}

/**
* Target specified by a Rule or a Request.
*/
message Target {
  repeated Attribute subject = 1;
  repeated Attribute resources = 2;
  repeated Attribute action = 3;
}

/**
* Key-value pair.
*/
message Attribute {
  string id = 1;
  string value = 2;
}

/**
* Resulting effect from a Policy or Rule.
*/
enum Effect {
  PERMIT = 0;
  DENY = 1;
}

service Service {
  rpc IsAllowed (Request) returns (Response);
}
